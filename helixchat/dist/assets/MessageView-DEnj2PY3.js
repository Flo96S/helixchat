var E=Object.defineProperty;var q=(e,s,t)=>s in e?E(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var g=(e,s,t)=>(q(e,typeof s!="symbol"?s+"":s,t),t);import{a as p}from"./axios-B4uVmeYG.js";import{d as b,_ as f,o as n,c as i,a as o,F as w,n as x,t as h,k as y,w as V,v as D,p as S,q as C,s as M,u as $,l as F,f as k,x as _,b as O,y as I}from"./index-LACCAfl5.js";const j=b({name:"InputField",data(){return{inputText:"",showsmile:!1,smileys:["ðŸ˜Š","ðŸ˜‚","ðŸ¤£","ðŸ˜","ðŸ˜„","ðŸ˜’","ðŸ«¡","ðŸ‘","ðŸ‘Œ","ðŸ™Œ","ðŸŽ¶","ðŸ“·","ðŸ’»","ðŸ¢"]}},methods:{toCamera(){this.$router.replace("/camera")},toggleSmileys(){this.showsmile=!this.showsmile},clickedOnSmiley(e){this.inputText+=this.smileys[e]},async sendMessage(){const e="https://www2.hs-esslingen.de/~melcher/map/chat/api/",s=localStorage.getItem("token")||sessionStorage.getItem("token"),t=this.getValue();if(t.length==0)return;this.inputText="";const r=await p.post(e,{request:"postmessage",token:s,text:t});if(r.data.status!=="ok"){console.log("Error: "+r.data.status);return}console.log(r.data)},getValue(){return this.inputText}}}),A={class:"h-9 fixed bottom-4 left-4 right-4 overscroll-y-none"},N={key:0,class:"min-h-12 w-full bg-white absolute bottom-12 p-2 rounded-xl transition-all duration-1000"},U={class:"flex flex-wrap list-none"},L=["onClick"],P={class:"flex h-full gap-1"},z={class:"text-black relative w-full"};function G(e,s,t,r,c,l){return n(),i("div",A,[e.showsmile?(n(),i("div",N,[o("ul",U,[(n(!0),i(w,null,x(e.smileys,(a,d)=>(n(),i("li",{key:d,class:"py-2 m-1"},[o("a",{class:"opacity-100 p-2 text-xl select-none cursor-pointer bg-slate-50 rounded-lg",onClick:m=>e.clickedOnSmiley(d)},h(a),9,L)]))),128))])])):y("",!0),o("div",P,[o("div",z,[V(o("input",{class:"pl-2 rounded-xl w-full h-full",placeholder:"Nachricht","onUpdate:modelValue":s[0]||(s[0]=a=>e.inputText=a)},null,512),[[D,e.inputText]]),o("button",{class:"absolute right-0 h-full px-1 text-2xl",onClick:s[1]||(s[1]=(...a)=>e.toggleSmileys&&e.toggleSmileys(...a))},"ðŸ“Ž")]),o("button",{class:"bg-blue-800 text-white icon-camera w-12 rounded-xl",onClick:s[2]||(s[2]=(...a)=>e.toCamera&&e.toCamera(...a))}),o("button",{class:"bg-blue-800 text-white icon-paper-plane w-12 rounded-xl",onClick:s[3]||(s[3]=(...a)=>e.sendMessage&&e.sendMessage(...a))})])])}const R=f(j,[["render",G]]);class B{constructor(s,t,r,c,l,a,d){g(this,"chatid");g(this,"id");g(this,"text");g(this,"time");g(this,"userhash");g(this,"usernickname");g(this,"imageid");this.chatid=s,this.id=t,this.text=r,this.time=this.parseTime(c)||new Date,this.userhash=l,this.usernickname=a,this.imageid=d}parseTime(s){const t=/^(\d{4})-(\d{2})-(\d{2})_(\d{2})-(\d{2})-(\d{2})$/,r=s.match(t);if(!r)return console.error("Invalid date-time string format"),null;const[,c,l,a,d,m,u]=r.map(Number);return new Date(c,l-1,a,d,m,u)}}const Y=b({name:"MessageBubble",data(){return{imagesrc:""}},props:{message:{type:Object,required:!0}},mounted:function(){this.getPhoto()},methods:{async getPhoto(){if(this.message.imageid!==void 0){console.log("LOAD IMAGE");try{const e=await p.get("https://www2.hs-esslingen.de/~melcher/map/chat/api/",{params:{request:"getphoto",token:localStorage.getItem("token")||sessionStorage.getItem("token"),photoid:this.message.imageid},responseType:"arraybuffer"});if(e.status!=200){console.log("Error - : "+e.data.status);return}const s=e.data,t=new Uint8Array(s);let r="";t.forEach(a=>{r+=String.fromCharCode(a)});let l=`data:image/png;base64,${btoa(r)}`;this.imagesrc=l,console.log(l)}catch{console.log("Could not load images")}}}}}),H=e=>(S("data-v-0a7b2bae"),e=e(),C(),e),J={class:"bg-cyan-800 rounded-2xl p-3 space-y-2 ml-6 relative"},K={class:"relative mb-6"},Q=H(()=>o("p",{class:"absolute opacity-75"},"You",-1)),W={class:"text-white absolute right-0 opacity-75"},X=["src"],Z={class:"text-white"};function ee(e,s,t,r,c,l){return n(),i("div",J,[o("div",K,[Q,o("p",W,h(e.message.time.toLocaleTimeString()),1)]),e.imagesrc?(n(),i("img",{key:0,class:"rounded-xl",src:e.imagesrc},null,8,X)):y("",!0),o("p",Z,h(e.message.text),1)])}const se=f(Y,[["render",ee],["__scopeId","data-v-0a7b2bae"]]);let v=0;const te=b({name:"MessageBubble",data(){return{imagesrc:""}},props:{message:{type:B,required:!0}},mounted:function(){this.getPhoto()},methods:{getColorClass(){let e=0;for(let t=0;t<this.message.userhash.length;t++)e+=this.message.userhash.charCodeAt(t);let s=["bg-blue-900","bg-green-900","bg-teal-800","bg-lime-900","bg-yellow-900","bg-indigo-900","bg-pink-900","bg-purple-900","bg-red-900","bg-orange-900","bg-cyan-900"];return v=e%s.length-1,s[v]},async getPhoto(){if(this.message.imageid!==void 0)try{const e=await p.get("https://www2.hs-esslingen.de/~melcher/map/chat/api/",{params:{request:"getphoto",token:localStorage.getItem("token")||sessionStorage.getItem("token"),photoid:this.message.imageid},responseType:"arraybuffer"});if(e.status!=200){console.log("Error - : "+e.data.status);return}const s=e.data,t=new Uint8Array(s);let r="";t.forEach(a=>{r+=String.fromCharCode(a)});let l=`data:image/png;base64,${btoa(r)}`;this.imagesrc=l}catch{console.log("Could not load images")}}}}),oe=e=>(S("data-v-7e911619"),e=e(),C(),e),ae=oe(()=>o("img",{class:"w-6 h-6 mr-2 rounded-full aspect-square object-cover bg-slate-700",src:"https://thumbs.dreamstime.com/b/hund-des-goldenen-apportierhunds-21668976.jpg"},null,-1)),re={class:"text-white font-bold"},ne={class:"text-white absolute right-2 flex opacity-75"},le={class:"flex-0"},ie=["src"],ce={class:"text-white"};function de(e,s,t,r,c,l){return n(),i("div",{class:M(["bg-sky-800 rounded-2xl p-2 space-y-2 mr-6 relative",[e.getColorClass()]])},[o("div",{class:"flex items-center cursor-pointer",onClick:s[0]||(s[0]=()=>{console.log("clicked"),console.log(e.getColorClass())})},[ae,o("p",re,h(e.message.usernickname),1),o("p",ne,h(e.message.time.toLocaleTimeString()),1)]),o("div",le,[e.imagesrc?(n(),i("img",{key:0,class:"rounded-xl",src:e.imagesrc},null,8,ie)):y("",!0),o("p",ce,h(e.message.text),1)])],2)}const ge=f(te,[["render",de],["__scopeId","data-v-7e911619"]]),ue=b({setup(){const e=$();return{backgroundImage:F(()=>e.state.backgroundImage)}},components:{MessageBubble:se,MessageBubbleOthers:ge,InputField:R},data(){return{Messages:[],UserId:localStorage.getItem("hash")||sessionStorage.getItem("hash")}},computed:{backgroundImage(){return $().state.backgroundImage}},methods:{async getMessages(e){try{const s=await p.get("https://www2.hs-esslingen.de/~melcher/map/chat/api/",{params:{request:"getmessages",token:localStorage.getItem("token")||sessionStorage.getItem("token"),chatId:e}});if(s.data.status!=="ok"){console.log("Error: "+s.data.status);return}this.Messages=s.data.messages.map(t=>new B(t.chatid,t.id,t.text,t.time,t.userhash,t.usernickname,t.photoid))}catch(s){console.log(s),console.log("Error while fetching messages"),localStorage.removeItem("token"),localStorage.removeItem("hash"),sessionStorage.removeItem("token"),sessionStorage.removeItem("hash"),this.$router.replace("/login")}},goBack(){this.$router.replace("/")},scrollDown(){this.$refs.bottomEl.scrollIntoView({})}},created(){this.getMessages("chatId")},watch:{Messages(){this.$nextTick(()=>{this.scrollDown()})}}}),he={class:"bg-blue-800 text-white pl-2 py-4 flex flex-row drop-shadow-lg"},me=o("a",{class:"icon-left-open"},null,-1),pe=[me],be=o("a",{class:"ml-2"},"Chat 1",-1),fe={class:"space-y-4 pb-12",ref:"scroll"},ke={ref:"bottomEl"};function we(e,s,t,r,c,l){const a=k("MessageBubble"),d=k("MessageBubbleOthers"),m=k("InputField");return n(),i("div",{class:"flex flex-col h-screen",style:_({backgroundImage:`url(/backgrounds/${e.backgroundImage}.jpg)`})},[o("nav",he,[o("button",{onClick:s[0]||(s[0]=(...u)=>e.goBack&&e.goBack(...u)),class:"text-white hover:underline px-2"},pe),be]),o("div",{class:M(["flex-grow overflow-auto p-4",{"bg-cover":!0,"bg-center":!0,"bg-no-repeat":!0,"bg-fixed":!0}]),style:_({backgroundImage:`url(/backgrounds/${e.backgroundImage}.jpg)`})},[o("div",fe,[(n(!0),i(w,null,x(e.Messages,(u,T)=>(n(),i(w,{key:T},[u.userhash===e.UserId?(n(),I(a,{key:0,message:u},null,8,["message"])):(n(),I(d,{key:1,message:u},null,8,["message"]))],64))),128)),o("div",ke,null,512)],512)],4),O(m)],4)}const Ie=f(ue,[["render",we]]);export{Ie as default};
